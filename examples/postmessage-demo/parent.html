<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>PostMessageCommAPI 演示 - Parent</title>
  <style>
    body { font-family: sans-serif; }
    .log { border: 1px solid #ccc; height: 160px; overflow: auto; padding: 8px; }
  </style>
</head>
<body>
  <h1>Parent 页面</h1>
  <iframe id="child" src="iframe.html" width="480" height="240"></iframe>

  <div>
    <input id="msg" placeholder="输入消息" />
    <button id="send">发送到 iframe</button>
  </div>
  <div class="log" id="log"></div>

  <script>
    const log = (text) => {
      const el = document.getElementById('log');
      el.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${text}</div>`;
      el.scrollTop = el.scrollHeight;
    };

    const iframe = document.getElementById('child').contentWindow;

    window.addEventListener('message', (event) => {
      // 在实际项目中请校验 event.origin
      log(`收到来自 iframe 的消息: ${JSON.stringify(event.data)}`);
    });

    document.getElementById('send').addEventListener('click', () => {
      const text = document.getElementById('msg').value;
      iframe.postMessage({ type: 'chat', content: text }, '*');
      log(`向 iframe 发送消息: ${text}`);
    });
  </script>
</body>
</html>
